---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { SUPPORTED_LANGS, DEFAULT_LANG, isValidLanguage } from '../../utils/i18n';
import { readFileSync, existsSync } from 'fs';
import { join } from 'path';
import { marked } from 'marked';

export function getStaticPaths() {
  return SUPPORTED_LANGS.map(lang => ({
    params: { lang }
  }));
}

const { lang } = Astro.params;

if (!isValidLanguage(lang)) {
  return Astro.redirect(`/${DEFAULT_LANG}/support`);
}

// Load markdown content
const contentPath = join(process.cwd(), 'content', 'pages', lang, 'support.md');
let content = '';
let title = 'Support Â· Vokabulo';

if (existsSync(contentPath)) {
  const fileContent = readFileSync(contentPath, 'utf-8');
  // Extract frontmatter
  const frontmatterMatch = fileContent.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
  if (frontmatterMatch) {
    const frontmatter = frontmatterMatch[1];
    const markdown = frontmatterMatch[2];
    const titleMatch = frontmatter.match(/title:\s*["'](.*)["']/);
    if (titleMatch) title = titleMatch[1];
    content = marked.parse(markdown);
  } else {
    content = marked.parse(fileContent);
  }
}
---

<BaseLayout title={title} currentLang={lang} currentPath="/support">
  <style>
    /* Support page-specific styles */
    :root {
      --accent: #0ea5e9;
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 16px 48px;
    }

    main {
      padding: 48px 40px;
      padding-top: 140px;
    }

    h1 {
      margin: 0 0 24px;
      font-size: 40px;
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.02em;
    }

    h2 {
      margin: 48px 0 16px;
      font-size: 28px;
      font-weight: 700;
      line-height: 1.3;
      color: var(--ink);
      letter-spacing: -0.01em;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    h2:first-of-type {
      margin-top: 0;
      padding-top: 0;
      border-top: none;
    }

    h3 {
      margin: 40px 0 16px;
      font-size: 20px;
      font-weight: 600;
      line-height: 1.4;
      color: var(--ink);
      letter-spacing: -0.01em;
      scroll-margin-top: 100px;
    }

    p {
      margin: 0 0 20px;
      color: var(--muted);
      line-height: 1.7;
      font-size: 16px;
    }

    ul {
      padding-left: 24px;
      margin: 0 0 20px;
      color: var(--muted);
      line-height: 1.7;
      font-size: 16px;
    }

    ul li {
      margin: 0 0 12px;
    }

    ul li strong {
      color: var(--ink);
      font-weight: 600;
    }

    strong {
      color: var(--ink);
      font-weight: 600;
    }

    hr {
      border: none;
      border-top: 1px solid var(--border);
      margin: 32px 0;
    }

    .help-article {
      max-width: 750px;
      margin: 0 auto;
    }

    @media (prefers-color-scheme: dark) {
      :root:not(.theme-dark) {
        color-scheme: dark;
        --bg: #0b1220;
        --border: #1f2937;
        --ink: #e5e7eb;
        --muted: #cbd5e1;
        --accent: #38bdf8;
      }
    }

    .theme-dark {
      color-scheme: dark;
      --bg: #0b1220;
      --border: #1f2937;
      --ink: #e5e7eb;
      --muted: #cbd5e1;
      --accent: #38bdf8;
    }
  </style>

  <div class="page">
    <main>
      <article class="help-article">
        <Fragment set:html={content} />
      </article>
    </main>
  </div>
</BaseLayout>
