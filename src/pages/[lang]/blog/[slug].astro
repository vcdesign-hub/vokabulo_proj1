---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { SUPPORTED_LANGS, DEFAULT_LANG, isValidLanguage } from '../../../utils/i18n';
import { loadBlogPost, getAllBlogSlugs, isUsingFallback } from '../../../utils/blog';
import '../../../styles/styles.css';

export function getStaticPaths() {
  const paths: Array<{ params: { lang: string; slug: string } }> = [];
  SUPPORTED_LANGS.forEach(lang => {
    const slugs = getAllBlogSlugs(lang);
    slugs.forEach(slug => {
      paths.push({ params: { lang, slug } });
    });
  });
  return paths;
}

const { lang, slug } = Astro.params;

if (!isValidLanguage(lang)) {
  return Astro.redirect(`/${DEFAULT_LANG}/blog`);
}

const post = loadBlogPost(lang, slug);

if (!post) {
  return Astro.redirect(`/${lang}/blog`);
}

const showFallbackNote = isUsingFallback(lang);
---

<BaseLayout title={`${post.title} Â· Vokabulo Blog`} currentLang={lang} currentPath={`/blog/${slug}`}>
  <div class="post-page hero-animate">
    <div class="post-container">
      
      <a href={`/${lang}/blog`} class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Blog
      </a>

      {showFallbackNote && (
        <div class="translation-note">
          Translation coming soon. Showing English version. [cite: 57]
        </div>
      )}
      
      <header class="post-header">
        {post.tag && (
          <div class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-transparent backdrop-blur px-3 py-1 text-xs font-semibold uppercase tracking-[0.14em] text-slate-700 shadow-sm">
            {post.tag}
          </div>
        )}
        <br>
        <br>

        <h1>{post.title}</h1>
        <p class="text-slate-500 font-medium">{post.date}</p>
      </header>

      {post.image && (
        <img
          class="post-hero-image"
          src={post.image}
          alt={post.imageAlt || post.title}
          loading="eager"
        />
      )}

      <article class="post-content md-content md-content--lg">
        <Fragment set:html={post.content} />
      </article>
    </div>
  </div>
</BaseLayout>